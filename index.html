<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <title>A S√∂t√©t M√°gia √ötveszt≈ëje</title>
  
  <!-- PWA be√°ll√≠t√°sok -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  
  <!-- SEO √©s k√∂z√∂ss√©gi m√©dia be√°ll√≠t√°sok -->
  <meta name="description" content="Dark fantasy kalandk√∂nyv, ahol a f≈ëh≈ës te vagy!">
  <meta name="keywords" content="kalandk√∂nyv, interakt√≠v k√∂nyv, fantasy, s√∂t√©t m√°gia">
  <link rel="icon" href="files/icon-512.png" type="image/png">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="A S√∂t√©t M√°gia √ötveszt≈ëje">
  <meta property="og:description" content="Dark fantasy kalandk√∂nyv, ahol a f≈ëh≈ës te vagy!">
  <meta property="og:image" content="./files/icon-512.png">
  
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #323232;
    }
    
    #book {
      width: 100%;
      height: 100%;
    }
    
    /* StPageFlip st√≠lusok be√°gyazva */
    .stf__parent {
      position: relative;
      display: block;
      box-sizing: border-box;
      transform: translateZ(0);
      -ms-touch-action: pan-y;
      touch-action: pan-y;
    }

    .sft__wrapper {
      position: relative;
      width: 100%;
      box-sizing: border-box;
    }

    .stf__parent canvas {
      position: absolute;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
    }

    .stf__block {
      position: absolute;
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      perspective: 2000px;
    }

    .stf__item {
      display: none;
      position: absolute;
      transform-style: preserve-3d;
    }

    .stf__outerShadow, .stf__innerShadow, .stf__hardShadow, .stf__hardInnerShadow {
      position: absolute;
      left: 0;
      top: 0;
    }
    
    /* Vez√©rl≈ëk */
    .controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      gap: 10px;
    }
    
    .controls button {
      padding: 10px 20px;
      background: black;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    /* Kockadob√°s widget */
    #dice-widget-container {
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 10px;
      padding: 10px;
      display: none;
    }
    
    .dice-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      background: #7f00ff;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
	
    #fullscreen-button {
      position: fixed;
      bottom: 20%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1001;
      color: white;
      background: rgba(0, 0, 0, 0.6);
      padding: 8px 16px;
      border-radius: 4px;
      font-family: Arial, sans-serif;
      font-size: 16px;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }

    .mute-toggle {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      background: #7f00ff;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #page-indicator {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      font-family: 'Cinzel', serif;
      font-size: 1.2rem;
      z-index: 1000;
      pointer-events: none;
    }
    
    /* Oldalst√≠lusok */
    .page-content {
      width: 100%;
      height: 100%;
      box-sizing: border-box;
      padding: 30px;
      font-family: 'Cinzel', serif;
      background-color: #f5f5dc; /* pergamen h√°tt√©r */
      color: #333;
      overflow: auto;
    }
    
    .page-title {
      text-align: center;
      margin-bottom: 20px;
      font-size: 24px;
      border-bottom: 1px solid #963;
      padding-bottom: 10px;
    }
    
    .page-text {
      font-size: 16px;
      line-height: 1.6;
      text-align: justify;
    }
    
    .choices {
      margin-top: 30px;
      border-top: 1px dashed #963;
      padding-top: 15px;
    }
    
    .choices a {
      display: block;
      margin: 10px 0;
      padding: 10px;
      background: rgba(150, 100, 50, 0.1);
      border-radius: 5px;
      color: #633;
      text-decoration: none;
      transition: background 0.3s;
      cursor: pointer;
    }
    
    .choices a:hover {
      background: rgba(150, 100, 50, 0.2);
    }
    
    .page-number {
      text-align: center;
      margin-top: 20px;
      font-style: italic;
    }
    
    /* Speci√°lis oldalst√≠lusok */
    .page-dark {
      background-color: #333;
      color: #f5f5dc;
    }
    
    .page-battle {
      background-color: #5c0000;
      color: #f5f5dc;
    }
  </style>
</head>
<body>
  <!-- K√∂nyv kont√©ner -->
  <div id="book"></div>
  
  <!-- Kockadob√°s widget -->
  <button class="dice-toggle" onclick="toggleDiceWidget()" style="padding: 4px 6px;">
    <span style="font-size: 15px;">üé≤üé≤üé≤</span>
  </button>

  <div id="dice-widget-container"></div>

  <!-- Kockadob√°s szkript -->
  <script>
    // Kockadob√°s widget funkci√≥k
    function toggleDiceWidget() {
      const container = document.getElementById('dice-widget-container');
      if (container.style.display === 'none' || container.style.display === '') {
        container.style.display = 'block';
        showDiceRoll();
      } else {
        container.style.display = 'none';
      }
    }

    function showDiceRoll() {
      const container = document.getElementById("dice-widget-container");
      if (!container) return;

      container.innerHTML = `
          <div style="text-align:center; margin-top:20px;">
              <h3 style="font-family:'Cinzel', serif; color:white; background:black; display:inline-block; padding:10px; border-radius:5px;">
                  Harci Kockadob√°s
              </h3>
              <br>
              <button onclick="rollDice()" style="padding:10px 20px; margin-top:10px; background:#7f00ff; color:white; border:none; border-radius:5px; font-size:1.1rem; cursor:pointer;">
                  Dob√°s
              </button>
              <div class="dice-results" id="dice-images" style="display:flex; justify-content:center; gap:10px; margin-top:20px;"></div>
              <div id="success-results" style="background:black; color:white; display:inline-block; padding:5px 10px; border-radius:5px; margin-top:10px; font-size:1.2rem;"></div>
          </div>
      `;
    }

    function rollDice() {
      const diceImages = {
        1: 'images/d1.png',
        2: 'images/d2.png',
        3: 'images/d3.png',
        4: 'images/d4.png',
        5: 'images/d5.png',
        6: 'images/d6.png'
      };

      const diceContainer = document.getElementById('dice-images');
      const successResults = document.getElementById('success-results');
      diceContainer.innerHTML = '';

      let successes = 0;

      for (let i = 0; i < 3; i++) {
        const roll = Math.floor(Math.random() * 6) + 1;
        const img = document.createElement('img');
        img.src = diceImages[roll];
        img.alt = `Kocka: ${roll}`;
        img.style.width = '80px';
        img.style.height = '80px';
        diceContainer.appendChild(img);

        if (roll >= 4) {
          successes++;
        }
      }

      let successText = '';
      switch (successes) {
        case 0:
          successText = 'Nincs Siker';
          break;
        case 1:
          successText = 'Egy Siker';
          break;
        case 2:
          successText = 'K√©t Siker';
          break;
        case 3:
          successText = 'H√°rom Siker';
          break;
      }

      successResults.textContent = successText;
    }
  </script>

  <!-- Eredeti StPageFlip k√∂nyvt√°r bet√∂lt√©se -->
  <link rel="stylesheet" href="css/page-flip.min.css" />
  <script src="js/page-flip.browser.js"></script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Oldalak defin√≠ci√≥ja: bor√≠t√≥ k√©p + HTML oldalak
      const pages = [
        // Bor√≠t√≥ oldal (k√©pk√©nt)
        {
          type: 'image',
          src: 'images/oldalak/borito.webp',
          density: 'hard'
        },
        // HTML oldalak
        {
          type: 'html',
          src: 'pages/page-1.html'
        },
        {
          type: 'html',
          src: 'pages/page-2.html'
        },
        {
          type: 'html',
          src: 'pages/page-3.html'
        },
        {
          type: 'html',
          src: 'pages/page-4.html'
        },
        {
          type: 'html',
          src: 'pages/page-5.html'
        },
        {
          type: 'html',
          src: 'pages/page-6.html'
        },
        {
          type: 'html',
          src: 'pages/page-7.html'
        },
        {
          type: 'html',
          src: 'pages/page-8.html'
        },
        {
          type: 'html',
          src: 'pages/page-9.html'
        }
      ];

      // PageFlip inicializ√°l√°sa
      const pageFlip = new St.PageFlip(document.getElementById("book"), {
        width: 550,
        height: 733,
        size: "stretch",
        minWidth: 320,
        maxWidth: 1000,
        minHeight: 400,
        maxHeight: 1533,
        maxShadowOpacity: 0.5,
        showCover: true,
        mobileScrollSupport: false
      });

      // HTML oldalak √©s k√©p oldalak kombin√°l√°sa
      loadMixedPages(pages, pageFlip);

      const flipSound = document.getElementById("flipSound");
      const fullscreenBtn = document.getElementById("fullscreen-button");
      const pageIndicator = document.getElementById("page-indicator");
      const muteButton = document.getElementById("mute-button");

      let isMuted = false;

      // N√©m√≠t√°s gomb m≈±k√∂d√©se
      muteButton.addEventListener("click", () => {
        isMuted = !isMuted;
        muteButton.textContent = isMuted ? "üîá" : "üîä";
      });

      // Teljes k√©perny≈ëre v√°lt√°s
      fullscreenBtn.addEventListener("click", () => {
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
          elem.requestFullscreen();
        } else if (elem.webkitRequestFullscreen) {
          elem.webkitRequestFullscreen();
        } else if (elem.msRequestFullscreen) {
          elem.msRequestFullscreen();
        }
      });

      // Ha m√°r fullscreenbe v√°ltott, akkor is t≈±nj√∂n el a gomb
      document.addEventListener("fullscreenchange", () => {
        if (document.fullscreenElement) {
          fullscreenBtn.style.display = "none";
        }
      });

      // Oldalsz√°m friss√≠t√©se indul√°skor
      pageIndicator.textContent = `Oldal 1 / ${pages.length}`;

      // Lapoz√°s esem√©ny
      pageFlip.on('flip', (e) => {
        if (!isMuted) {
          flipSound.currentTime = 0;
          flipSound.play();
        }

        // Oldalsz√°m friss√≠t√©se
        pageIndicator.textContent = `Oldal ${e.data + 1} / ${pages.length}`;

        // Teljes k√©perny≈ës gomb csak az els≈ë oldalon
        fullscreenBtn.style.display = e.data === 0 ? "block" : "none";
      });
      
      // Linkek kezel√©se az oldalakon bel√ºl
      pageFlip.on('init', () => {
        setupPageLinks(pageFlip);
      });
    });

    // HTML oldalak bet√∂lt√©se √©s kombin√°l√°sa k√©p oldalakkal
    async function loadMixedPages(pages, pageFlip) {
      const pageElements = [];
      let loadedCount = 0;
      const totalPages = pages.length;
      
      // Bet√∂lt√©si folyamat indik√°tor
      const loading = document.getElementById('loading') || createLoadingIndicator();
      loading.textContent = `Bet√∂lt√©s: 0/${totalPages}`;
      
      for (const page of pages) {
        try {
          // HTML oldal bet√∂lt√©se
          if (page.type === 'html') {
            const pageElement = document.createElement('div');
            pageElement.className = 'page';
            
            // Ha ez kem√©ny fed√©l lenne
            if (page.density === 'hard') {
              pageElement.setAttribute('data-density', 'hard');
            }
            
            // HTML tartalom bet√∂lt√©se a f√°jlb√≥l
            try {
              const response = await fetch(page.src);
              if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
              }
              const html = await response.text();
              pageElement.innerHTML = html;
            } catch (error) {
              console.error(`Hiba a(z) ${page.src} oldal bet√∂lt√©sekor:`, error);
              pageElement.innerHTML = `<div class="page-content"><h2>Hiba t√∂rt√©nt</h2><p>Az oldal nem t√∂lthet≈ë be: ${page.src}</p></div>`;
            }
            
            pageElements.push(pageElement);
          } 
          // K√©p oldal bet√∂lt√©se
          else if (page.type === 'image') {
            const pageElement = document.createElement('div');
            pageElement.className = 'page';
            
            if (page.density === 'hard') {
              pageElement.setAttribute('data-density', 'hard');
            }
            
            // K√©p h√°tt√©r be√°ll√≠t√°sa
            const content = document.createElement('div');
            content.className = 'page-content';
            content.style.padding = '0';
            content.style.backgroundImage = `url(${page.src})`;
            content.style.backgroundSize = 'cover';
            content.style.backgroundPosition = 'center';
            
            pageElement.appendChild(content);
            pageElements.push(pageElement);
          }
          
          // Bet√∂lt√©si folyamat friss√≠t√©se
          loadedCount++;
          loading.textContent = `Bet√∂lt√©s: ${loadedCount}/${totalPages}`;
        } catch (error) {
          console.error("Hiba az oldal bet√∂lt√©sekor:", error);
        }
      }
      
      // Bet√∂lt√©s k√©sz, elrejtem a bet√∂lt√©si indik√°tort
      loading.style.display = 'none';
      
      // Hozz√°adom az oldalakat a PageFlip-hez
      pageFlip.loadFromHTML(pageElements);
    }
    
    // Bet√∂lt√©si indik√°tor k√©sz√≠t√©se, ha nem l√©tezik
    function createLoadingIndicator() {
      const loading = document.createElement('div');
      loading.id = 'loading';
      loading.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        z-index: 9999;
      `;
      document.body.appendChild(loading);
      return loading;
    }
    
    // Oldalon bel√ºli linkek kezel√©se a lapoz√°shoz
    function setupPageLinks(pageFlip) {
      document.querySelectorAll('.choices a[data-page]').forEach(link => {
        link.addEventListener('click', function(e) {
          e.preventDefault();
          const targetPage = parseInt(this.getAttribute('data-page'));
          if (!isNaN(targetPage) && targetPage > 0 && targetPage <= pageFlip.getPageCount()) {
            pageFlip.flip(targetPage - 1); // 0-alap√∫ indexel√©s
          }
        });
      });
    }
  </script>

  <audio id="flipSound" src="sounds/pageturn-102978.mp3" preload="auto"></audio>
  <div id="fullscreen-button">Kattints ide a teljes k√©perny≈ës n√©zet√©rt</div>
  <div id="page-indicator">Oldal 1 / 10</div>

  <button id="mute-button" class="mute-toggle" title="Hang ki/be">üîä</button>
</body>
</html>