<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A S√∂t√©t M√°gia √ötveszt≈ëje</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0; padding: 0; width: 100%; height: 100%;
      overflow: hidden; background-color: #323232; font-family: 'Cinzel', serif;
    }
    #book-container {
      width: 100%; height: 100vh; overflow: hidden; position: relative;
    }
    #book-page {
      width: 100%; height: 100%; border: none; transition: opacity 0.3s, transform 0.3s;
    }
    .controls, #fullscreen-button, #page-indicator, .mute-toggle {
      position: fixed; z-index: 1000;
    }
    .controls {
      bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px;
    }
    .controls button, #fullscreen-button {
      padding: 10px; background: black; color: white; border-radius: 5px; cursor: pointer; border: none;
    }
    #fullscreen-button {
      bottom: 15%; left: 50%; transform: translateX(-50%);
    }
    .mute-toggle {
      bottom: 20px; left: 20px; width: 50px; height: 50px; background: #7f00ff; color: white;
      border-radius: 50%; cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center;
    }
    #page-indicator {
      bottom: 60px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: white; padding: 8px 16px; border-radius: 10px; pointer-events: none;
    }
	
	/* Kockadob√°s widgetek bels≈ë st√≠lusai */
    .dice-title {
      font-family: 'Cinzel', serif;
      color: white;
      background: black;
      display: inline-block;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      margin-bottom: 10px;
    }
    
    .dice-button {
      padding: 10px 20px;
      margin-top: 10px;
      background: #7f00ff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(127, 0, 255, 0.5);
    }
    
    .dice-button:hover {
      background: #a020f0;
      transform: scale(1.05);
    }
    
    .dice-results {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    
    #success-results {
      background: black;
      color: white;
      display: inline-block;
      padding: 5px 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>

  <div id="book-container">
    <iframe id="book-page" src="pages/1.html"></iframe>
  </div>

  <div class="controls">
    <button id="prev-btn">‚óÄ El≈ëz≈ë oldal</button>
    <button id="next-btn">K√∂vetkez≈ë oldal ‚ñ∂</button>
    <button id="save-btn">üîñ Ment√©s</button>
    <button id="load-btn">üìë Bet√∂lt√©s</button>
    <button id="zoom-btn">üîç Zoom</button>
  </div>

  <div id="page-indicator">Oldal 1 / 300</div>
  <button id="fullscreen-button">Teljes k√©perny≈ë</button>
  <button id="mute-button" class="mute-toggle">üîä</button>
  
  <audio id="flipSound" src="sounds/pageturn-102978.mp3"></audio>

  <!-- Kockadob√°s widgetek -->
  <button class="dice-toggle" onclick="toggleDiceWidget()" title="3 Kock√°s dob√°s" style="padding: 4px 6px;">
    <span style="font-size: 15px;">üé≤üé≤üé≤</span>
  </button>
  <div id="dice-widget-container"></div>
  
  <button class="single-dice-toggle" onclick="toggleSingleDiceWidget()" title="1 Kock√°s dob√°s" style="padding: 4px 6px;">
    <span style="font-size: 15px;">üé≤</span>
  </button>
  <div id="single-dice-widget-container"></div>
  
<script>
// MINDEN FUNKCI√ì EGY HELYEN, J√ìL SZERVEZVE
document.addEventListener('DOMContentLoaded', () => {
  let currentPage = 1;
  const totalPages = 300;
  const iframe = document.getElementById('book-page');
  const flipSound = document.getElementById('flipSound');
  const pageIndicator = document.getElementById('page-indicator');

  const goToPage = num => {
    if (num < 1 || num > totalPages) return;
    iframe.style.opacity = 0;
    iframe.onload = () => { iframe.style.opacity = 1; updatePageIndicator(); };
    iframe.src = `pages/${num}.html`;
    currentPage = num;
    if (!flipSound.muted) flipSound.play();
  };

  const updatePageIndicator = () => {
    pageIndicator.textContent = `Oldal ${currentPage} / ${totalPages}`;
  };

  document.getElementById('next-btn').onclick = () => goToPage(currentPage + 1);
  document.getElementById('prev-btn').onclick = () => goToPage(currentPage - 1);

  document.getElementById('save-btn').onclick = () => {
    localStorage.setItem('bookmark', currentPage);
    alert(`Mentve: ${currentPage}. oldal`);
  };

  document.getElementById('load-btn').onclick = () => {
    let p = +localStorage.getItem('bookmark');
    if (p) goToPage(p); else alert('Nincs mentve k√∂nyvjelz≈ë.');
  };

  let zoomed = false;
  document.getElementById('zoom-btn').onclick = () => {
    zoomed = !zoomed;
    iframe.style.transform = zoomed ? 'scale(1.5)' : 'scale(1)';
  };

  document.getElementById('fullscreen-button').onclick = () => {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
  };

  document.getElementById('mute-button').onclick = () => {
    flipSound.muted = !flipSound.muted;
    document.getElementById('mute-button').textContent = flipSound.muted ? 'üîá' : 'üîä';
  };

  // 3 kock√°s widget funkci√≥k
    function toggleDiceWidget() {
      const container = document.getElementById('dice-widget-container');
      if (container.style.display === 'none' || container.style.display === '') {
        // M√°sik widget elrejt√©se, ha l√°tszik
        document.getElementById('single-dice-widget-container').style.display = 'none';
        
        container.style.display = 'block';
        showDiceRoll();
      } else {
        container.style.display = 'none';
      }
    }

    function showDiceRoll() {
      const container = document.getElementById("dice-widget-container");
      if (!container) return;

      container.innerHTML = `
          <div style="text-align:center; margin-top:20px;">
              <h3 class="dice-title">
                  Harci Kockadob√°s
              </h3>
              <br>
              <button onclick="rollDice()" class="dice-button">
                  Dob√°s
              </button>
              <div class="dice-results" id="dice-images"></div>
              <div id="success-results"></div>
          </div>
      `;
    }

    function rollDice() {
      const diceImages = {
          1: 'images/d1.png',
          2: 'images/d2.png',
          3: 'images/d3.png',
          4: 'images/d4.png',
          5: 'images/d5.png',
          6: 'images/d6.png'
      };

      const diceContainer = document.getElementById('dice-images');
      const successResults = document.getElementById('success-results');
      diceContainer.innerHTML = '';

      let successes = 0;

      for (let i = 0; i < 3; i++) {
          const roll = Math.floor(Math.random() * 6) + 1;
          const img = document.createElement('img');
          img.src = diceImages[roll];
          img.alt = `Kocka: ${roll}`;
          img.style.width = '80px';
          img.style.height = '80px';
          diceContainer.appendChild(img);

          if (roll >= 4) {
              successes++;
          }
      }

      let successText = '';
      switch (successes) {
          case 0:
              successText = 'Nincs Siker';
              break;
          case 1:
              successText = 'Egy Siker';
              break;
          case 2:
              successText = 'K√©t Siker';
              break;
          case 3:
              successText = 'H√°rom Siker';
              break;
      }

      successResults.textContent = successText;
    }
    
    // 1 kock√°s widget funkci√≥k
    function toggleSingleDiceWidget() {
      const container = document.getElementById('single-dice-widget-container');
      if (container.style.display === 'none' || container.style.display === '') {
        // M√°sik widget elrejt√©se, ha l√°tszik
        document.getElementById('dice-widget-container').style.display = 'none';
        
        container.style.display = 'block';
        showSingleDiceRoll();
      } else {
        container.style.display = 'none';
      }
    }
    
    function showSingleDiceRoll() {
      const container = document.getElementById("single-dice-widget-container");
      if (!container) return;

      container.innerHTML = `
          <div style="text-align:center; margin-top:20px;">
              <h3 class="dice-title">
                  1D6 Kockadob√°s
              </h3>
              <br>
              <button onclick="rollSingleDice()" class="dice-button">
                  Dob√°s
              </button>
              <div class="dice-results" id="single-dice-image"></div>
          </div>
      `;
    }
    
    function rollSingleDice() {
      const diceImages = {
          1: 'images/d1.png',
          2: 'images/d2.png',
          3: 'images/d3.png',
          4: 'images/d4.png',
          5: 'images/d5.png',
          6: 'images/d6.png'
      };
      
      const diceContainer = document.getElementById('single-dice-image');
      diceContainer.innerHTML = ''; // El≈ëz≈ë k√©p t√∂rl√©se
      
      // 1D6 dob√°s
      const roll = Math.floor(Math.random() * 6) + 1;
      const img = document.createElement('img');
      img.src = diceImages[roll];
      img.alt = `Kocka: ${roll}`;
      img.style.width = '80px';
      img.style.height = '80px';
      diceContainer.appendChild(img);
    }

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js')
      .catch(e=>console.error('SW hiba:', e));
  }

  updatePageIndicator();
});
</script>
</body>
</html>
