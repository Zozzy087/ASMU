<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <title>A S√∂t√©t M√°gia √ötveszt≈ëje</title>
  
  <!-- PWA be√°ll√≠t√°sok -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  
  <!-- SEO √©s k√∂z√∂ss√©gi m√©dia be√°ll√≠t√°sok -->
  <meta name="description" content="Dark fantasy kalandk√∂nyv, ahol a f≈ëh≈ës te vagy!">
  <meta name="keywords" content="kalandk√∂nyv, interakt√≠v k√∂nyv, fantasy, s√∂t√©t m√°gia">
  <link rel="icon" href="files/icon-512.png" type="image/png">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="A S√∂t√©t M√°gia √ötveszt≈ëje">
  <meta property="og:description" content="Dark fantasy kalandk√∂nyv, ahol a f≈ëh≈ës te vagy!">
  <meta property="og:image" content="./files/icon-512.png">
  
  <!-- Google Font -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #323232;
      font-family: 'Cinzel', serif;
    }
    
    #book {
      width: 100%;
      height: 100%;
    }
    
    
    
    /* Vez√©rl≈ëk */
    .controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      gap: 10px;
    }
    
    .controls button {
      padding: 10px 20px;
      background: black;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    
    /* K√©t widget poz√≠cion√°l√°sa egym√°s alatt a jobb oldalon */
#dice-widget-container {
  position: fixed;
  bottom: 160px;  /* Feljebb helyezve, hogy alatta legyen hely a m√°siknak */
  right: 20px;
  z-index: 1000;
  background: rgba(0, 0, 0, 0.8);
  border-radius: 10px;
  padding: 10px;
  display: none;
}

#single-dice-widget-container {
  position: fixed;
  bottom: 80px;  /* Az 1 kock√°s dob√°s lejjebb */
  right: 20px;   /* Jobb oldalra, ugyanahov√° mint a m√°sik */
  z-index: 1000;
  background: rgba(0, 0, 0, 0.8);
  border-radius: 10px;
  padding: 10px;
  display: none;
}

.dice-toggle {
  position: fixed;
  bottom: 20px; 
  right: 20px;
  z-index: 1000;
  width: 50px;
  height: 50px;
  background: #7f00ff;
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.single-dice-toggle {
  position: fixed;
  bottom: 20px;
  right: 80px;  /* A 3 kock√°s mellett jobbra */
  z-index: 1000;
  width: 50px;
  height: 50px;
  background: #7f00ff;
  color: white;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  font-size: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
}
	
    #fullscreen-button {
      position: fixed;
      bottom: 20%;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1001;
      color: white;
      background: rgba(0, 0, 0, 0.6);
      padding: 8px 16px;
      border-radius: 4px;
      font-family: 'Cinzel', serif;
      font-size: 16px;
      cursor: pointer;
      transition: opacity 0.3s ease;
    }

    .mute-toggle {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      background: #7f00ff;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #page-indicator {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      font-family: 'Cinzel', serif;
      font-size: 1.2rem;
      z-index: 1000;
      pointer-events: none;
    }
    
    /* Kockadob√°s widgetek bels≈ë st√≠lusai */
    .dice-title {
      font-family: 'Cinzel', serif;
      color: white;
      background: black;
      display: inline-block;
      padding: 10px;
      border-radius: 5px;
      text-align: center;
      margin-bottom: 10px;
    }
    
    .dice-button {
      padding: 10px 20px;
      margin-top: 10px;
      background: #7f00ff;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 1.1rem;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(127, 0, 255, 0.5);
    }
    
    .dice-button:hover {
      background: #a020f0;
      transform: scale(1.05);
    }
    
    .dice-results {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 20px;
    }
    
    #success-results {
      background: black;
      color: white;
      display: inline-block;
      padding: 5px 10px;
      border-radius: 5px;
      margin-top: 10px;
      font-size: 1.2rem;
    }
	
	#book-container {
  width: 100%;
  height: 100vh;
  overflow: hidden;
  position: relative;
}

#book-page {
  width: 100%;
  height: 100%;
  border: none;
  transition: opacity 0.3s ease, transform 0.3s ease;
}


#book-page {
  width: 100%;
  height: 100%;
  border: none;
  position: absolute;
  left: 0;
  top: 0;
  transition: transform 0.5s ease, opacity 0.5s ease;
  z-index: 1;
}

#book-page.animate-out-left {
  transform: translateX(-100%) rotateY(-15deg);
  opacity: 0;
  z-index: 0;
}

#book-page.animate-out-right {
  transform: translateX(100%) rotateY(15deg);
  opacity: 0;
  z-index: 0;
}

#book-page.animate-in {
  transform: translateX(0) rotateY(0);
  opacity: 1;
  z-index: 1;
}

  </style>
</head>
<body>

  
  <!-- Kockadob√°s widgetek -->
  <button class="dice-toggle" onclick="toggleDiceWidget()" title="3 Kock√°s dob√°s" style="padding: 4px 6px;">
    <span style="font-size: 15px;">üé≤üé≤üé≤</span>
  </button>
  <div id="dice-widget-container"></div>
  
  <button class="single-dice-toggle" onclick="toggleSingleDiceWidget()" title="1 Kock√°s dob√°s" style="padding: 4px 6px;">
    <span style="font-size: 15px;">üé≤</span>
  </button>
  <div id="single-dice-widget-container"></div>
  
  <!-- K√∂nyv kont√©ner helyett iframe alap√∫ megold√°s -->

  <div id="book-container">
    <iframe id="book-page" src="pages/borito.html"></iframe>
  </div>

  <div class="controls">
    <button onclick="prevPage()">‚óÄ El≈ëz≈ë oldal</button>
    <button onclick="nextPage()">K√∂vetkez≈ë oldal ‚ñ∂</button>
    <button onclick="saveBookmark()">üîñ Ment√©s</button>
    <button onclick="loadBookmark()">üìë Bet√∂lt√©s</button>
    <button onclick="toggleZoom()">üîç Zoom</button>
  </div>

  <div id="page-indicator">Oldal 1 / 300</div>
  <div id="fullscreen-button">Teljes k√©perny≈ë</div>
  <button id="mute-button" class="mute-toggle">üîä</button>
  
  <audio id="flipSound" src="sounds/pageturn-102978.mp3" preload="auto"></audio>


  <!-- Kockadob√°s szkriptek -->
  <script>
    // 3 kock√°s widget funkci√≥k
    function toggleDiceWidget() {
      const container = document.getElementById('dice-widget-container');
      if (container.style.display === 'none' || container.style.display === '') {
        // M√°sik widget elrejt√©se, ha l√°tszik
        document.getElementById('single-dice-widget-container').style.display = 'none';
        
        container.style.display = 'block';
        showDiceRoll();
      } else {
        container.style.display = 'none';
      }
    }

    function showDiceRoll() {
      const container = document.getElementById("dice-widget-container");
      if (!container) return;

      container.innerHTML = `
          <div style="text-align:center; margin-top:20px;">
              <h3 class="dice-title">
                  Harci Kockadob√°s
              </h3>
              <br>
              <button onclick="rollDice()" class="dice-button">
                  Dob√°s
              </button>
              <div class="dice-results" id="dice-images"></div>
              <div id="success-results"></div>
          </div>
      `;
    }

    function rollDice() {
      const diceImages = {
          1: 'images/d1.png',
          2: 'images/d2.png',
          3: 'images/d3.png',
          4: 'images/d4.png',
          5: 'images/d5.png',
          6: 'images/d6.png'
      };

      const diceContainer = document.getElementById('dice-images');
      const successResults = document.getElementById('success-results');
      diceContainer.innerHTML = '';

      let successes = 0;

      for (let i = 0; i < 3; i++) {
          const roll = Math.floor(Math.random() * 6) + 1;
          const img = document.createElement('img');
          img.src = diceImages[roll];
          img.alt = `Kocka: ${roll}`;
          img.style.width = '80px';
          img.style.height = '80px';
          diceContainer.appendChild(img);

          if (roll >= 4) {
              successes++;
          }
      }

      let successText = '';
      switch (successes) {
          case 0:
              successText = 'Nincs Siker';
              break;
          case 1:
              successText = 'Egy Siker';
              break;
          case 2:
              successText = 'K√©t Siker';
              break;
          case 3:
              successText = 'H√°rom Siker';
              break;
      }

      successResults.textContent = successText;
    }
    
    // 1 kock√°s widget funkci√≥k
    function toggleSingleDiceWidget() {
      const container = document.getElementById('single-dice-widget-container');
      if (container.style.display === 'none' || container.style.display === '') {
        // M√°sik widget elrejt√©se, ha l√°tszik
        document.getElementById('dice-widget-container').style.display = 'none';
        
        container.style.display = 'block';
        showSingleDiceRoll();
      } else {
        container.style.display = 'none';
      }
    }
    
    function showSingleDiceRoll() {
      const container = document.getElementById("single-dice-widget-container");
      if (!container) return;

      container.innerHTML = `
          <div style="text-align:center; margin-top:20px;">
              <h3 class="dice-title">
                  1D6 Kockadob√°s
              </h3>
              <br>
              <button onclick="rollSingleDice()" class="dice-button">
                  Dob√°s
              </button>
              <div class="dice-results" id="single-dice-image"></div>
          </div>
      `;
    }
    
    function rollSingleDice() {
      const diceImages = {
          1: 'images/d1.png',
          2: 'images/d2.png',
          3: 'images/d3.png',
          4: 'images/d4.png',
          5: 'images/d5.png',
          6: 'images/d6.png'
      };
      
      const diceContainer = document.getElementById('single-dice-image');
      diceContainer.innerHTML = ''; // El≈ëz≈ë k√©p t√∂rl√©se
      
      // 1D6 dob√°s
      const roll = Math.floor(Math.random() * 6) + 1;
      const img = document.createElement('img');
      img.src = diceImages[roll];
      img.alt = `Kocka: ${roll}`;
      img.style.width = '80px';
      img.style.height = '80px';
      diceContainer.appendChild(img);
    }
  </script>

  

  <script>
    // CSAK EZEK MARADJANAK, EGYSZER:
    let currentPage = 0;
    const totalPages = 300;
    const iframe = document.getElementById('book-page');
    const pageIndicator = document.getElementById('page-indicator');
    const flipSound = document.getElementById('flipSound');
    const muteButton = document.getElementById('mute-button');

    function updatePageIndicator() {
  if (currentPage === 0) {
  } else {
    pageIndicator.textContent = `Oldal ${currentPage} / ${totalPages}`;
  }
}


    function goToPage(pageNumber) {
  if (pageNumber < 0 || pageNumber > totalPages || pageNumber === currentPage) return;

  const goingForward = pageNumber > currentPage;

  // Anim√°ci√≥ indul
  iframe.classList.remove('animate-in');
  iframe.classList.add(goingForward ? 'animate-out-left' : 'animate-out-right');

  setTimeout(() => {
    iframe.onload = () => {
      // Miut√°n √∫j oldal bet√∂lt≈ëd√∂tt, anim√°ci√≥ be
      iframe.classList.remove('animate-out-left', 'animate-out-right');
      void iframe.offsetWidth; // force reflow (hack)
      iframe.classList.add('animate-in');
      updatePageIndicator();
    };

    if (pageNumber === 0) {
      iframe.src = 'pages/borito.html';
    } else {
      iframe.src = `pages/${pageNumber}.html`;
    }

    currentPage = pageNumber;
    if (!flipSound.muted) flipSound.play();

  }, 0); // anim√°ci√≥s id≈ë kb. 5.3s
}



    function nextPage() { goToPage(currentPage + 1); }
    function prevPage() {
  if (currentPage > 0) goToPage(currentPage - 1);
}


    muteButton.addEventListener('click', () => {
      flipSound.muted = !flipSound.muted;
      muteButton.textContent = flipSound.muted ? 'üîá' : 'üîä';
    });

    function saveBookmark() {
      localStorage.setItem('bookmark', currentPage);
      alert(`K√∂nyvjelz≈ë mentve: ${currentPage}. oldal`);
    }

    function loadBookmark() {
      const savedPage = parseInt(localStorage.getItem('bookmark'), 10);
      if (savedPage) goToPage(savedPage);
      else alert('Nincs mentett k√∂nyvjelz≈ë!');
    }

    let zoomedIn = false;
    function toggleZoom() {
      zoomedIn = !zoomedIn;
      iframe.style.transform = zoomedIn ? 'scale(1.5)' : 'scale(1)';
    }

    document.getElementById('fullscreen-button').addEventListener('click', () => {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    });

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js')
        .then(() => console.log('Service Worker regisztr√°lva'))
        .catch(err => console.error('SW regisztr√°ci√≥ hiba:', err));
    }

    updatePageIndicator();
  </script>
</body>
</html>