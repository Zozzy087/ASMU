<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#000000">
  <title>A S√∂t√©t M√°gia √ötveszt≈ëje</title>
  
  <!-- PWA be√°ll√≠t√°sok -->
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  
  <link rel="stylesheet" href="css/page-flip.min.css" />
  
  <style>
    body, html {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      background-color: #323232;
    }
    
    #book {
      width: 100%;
      height: 100%;
    }
    
    /* Pozicion√°l√°s az interakt√≠v elemekhez */
    .page-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none; /* Alap√©rtelmezetten nem fogad kattint√°sokat */
    }
    
    /* Az interakt√≠v elemek viszont fogadnak kattint√°sokat */
    .interactive-element {
      position: absolute;
      pointer-events: auto;
      cursor: pointer;
    }
    
    /* P√©ld√°ul egy gomb a 2. oldalon */
    .page2-button {
      width: 200px;
      height: 50px;
      background-color: #9900ff;
      color: white;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
      transition: all 0.3s;
    }
    
    .page2-button:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
    }
    
    /* Dice widget style */
    #dice-widget-container {
      position: fixed;
      bottom: 80px;
      right: 20px;
      z-index: 1000;
      background: rgba(0, 0, 0, 0.8);
      border-radius: 10px;
      padding: 10px;
      display: none;
    }
    
    .dice-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      background: #7f00ff;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .mute-toggle {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 1000;
      width: 50px;
      height: 50px;
      background: #7f00ff;
      color: white;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    #page-indicator {
      position: fixed;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      font-family: 'Cinzel', serif;
      font-size: 1.2rem;
      z-index: 1000;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <!-- K√∂nyv kont√©ner -->
  <div id="book"></div>

  <!-- Kockadob√°s widget -->
  <button class="dice-toggle" onclick="toggleDiceWidget()">üé≤</button>
  <div id="dice-widget-container"></div>
  
  <div id="page-indicator">Oldal 1 / 10</div>
  <button id="mute-button" class="mute-toggle" title="Hang ki/be">üîä</button>
  
  <audio id="flipSound" src="sounds/pageturn-102978.mp3" preload="auto"></audio>
  
  <script src="js/page-flip.browser.js"></script>
  
  <script>
    // Kockadob√°s widget funkci√≥k
    function toggleDiceWidget() {
      const container = document.getElementById('dice-widget-container');
      if (container.style.display === 'none' || container.style.display === '') {
        container.style.display = 'block';
        showDiceRoll();
      } else {
        container.style.display = 'none';
      }
    }

    function showDiceRoll() {
      const container = document.getElementById("dice-widget-container");
      if (!container) return;

      container.innerHTML = `
          <div style="text-align:center; margin-top:20px;">
              <h3 style="font-family:'Cinzel', serif; color:white; background:black; display:inline-block; padding:10px; border-radius:5px;">
                  Harci Kockadob√°s
              </h3>
              <br>
              <button onclick="rollDice()" style="padding:10px 20px; margin-top:10px; background:#7f00ff; color:white; border:none; border-radius:5px; font-size:1.1rem; cursor:pointer;">
                  Dob√°s
              </button>
              <div class="dice-results" id="dice-images" style="display:flex; justify-content:center; gap:10px; margin-top:20px;"></div>
              <div id="success-results" style="background:black; color:white; display:inline-block; padding:5px 10px; border-radius:5px; margin-top:10px; font-size:1.2rem;"></div>
          </div>
      `;
    }

    function rollDice() {
      const diceImages = {
        1: 'images/d1.png',
        2: 'images/d2.png',
        3: 'images/d3.png',
        4: 'images/d4.png',
        5: 'images/d5.png',
        6: 'images/d6.png'
      };

      const diceContainer = document.getElementById('dice-images');
      const successResults = document.getElementById('success-results');
      diceContainer.innerHTML = '';

      let successes = 0;

      for (let i = 0; i < 3; i++) {
        const roll = Math.floor(Math.random() * 6) + 1;
        const img = document.createElement('img');
        img.src = diceImages[roll];
        img.alt = `Kocka: ${roll}`;
        img.style.width = '80px';
        img.style.height = '80px';
        diceContainer.appendChild(img);

        if (roll >= 4) {
          successes++;
        }
      }

      let successText = '';
      switch (successes) {
        case 0:
          successText = 'Nincs Siker';
          break;
        case 1:
          successText = 'Egy Siker';
          break;
        case 2:
          successText = 'K√©t Siker';
          break;
        case 3:
          successText = 'H√°rom Siker';
          break;
      }

      successResults.textContent = successText;
    }
    
    // Az oldalak interakt√≠v elemeinek defin√≠ci√≥ja
    const pageOverlays = {
      // Az els≈ë oldal (bor√≠t√≥ vagy impresszum) nem ig√©nyel interakt√≠v elemet
      'page0': { overlay: null },
      
      // A m√°sodik oldal - adunk egy gombot az als√≥ r√©szre
      'page1': {
        overlay: function(parent) {
          const overlay = document.createElement('div');
          overlay.className = 'page-overlay';
          
          // Gomb hozz√°ad√°sa
          const button = document.createElement('div');
          button.className = 'interactive-element page2-button';
          button.textContent = 'KATTINTS R√ÅM!';
          button.style.left = '50%';
          button.style.top = '70%';
          button.style.transform = 'translate(-50%, -50%)';
          button.addEventListener('click', function() {
            alert('Hamarosan √©rkezik a folytat√°s!');
          });
          
          overlay.appendChild(button);
          return overlay;
        }
      },
      
      // Tov√°bbi oldalak
      'page2': { overlay: null },
      'page3': { overlay: null },
      // ... stb.
    };
    
    document.addEventListener('DOMContentLoaded', function() {
      const pageFlip = new St.PageFlip(document.getElementById("book"), {
        width: 1979,
        height: 2800,
        size: "stretch",
        minWidth: 300,
        maxWidth: 1979,
        minHeight: 400,
        maxHeight: 2800,
        maxShadowOpacity: 0.5,
        showCover: true,
        mobileScrollSupport: true
      });
      
      // Az oldalak l√©trehoz√°sa Canva webp k√©pekb≈ël
      const pageImages = [
        'images/oldalak/borito.webp',
        'images/oldalak/elso-oldal.webp',
        'images/oldalak/masodik-oldal.webp',
        'images/oldalak/harmadik-oldal.webp',
        'images/oldalak/negyedik-oldal.webp',
        'images/oldalak/otodik-oldal.webp',
        'images/oldalak/hatodik-oldal.webp',
        'images/oldalak/hetedik-oldal.webp',
        'images/oldalak/nyolcadik-oldal.webp',
        'images/oldalak/kilencedik-oldal.webp'
      ];
      
      // HTML oldalak l√©trehoz√°sa
      const pageElements = [];
      
      // Canva k√©pek bet√∂lt√©se √©s az interakt√≠v elemek hozz√°ad√°sa
      pageImages.forEach((imageSrc, index) => {
        const pageElement = document.createElement('div');
        pageElement.className = 'page-element';
        
        // Els≈ë √©s utols√≥ oldal kem√©nybor√≠t√°s√∫
        if (index === 0 || index === pageImages.length - 1) {
          pageElement.setAttribute('data-density', 'hard');
        }
        
        // H√°tt√©rk√©p (Canva export√°lt k√©p)
        const pageBackground = document.createElement('div');
        pageBackground.className = 'page-background';
        pageBackground.style.width = '100%';
        pageBackground.style.height = '100%';
        pageBackground.style.backgroundImage = `url('${imageSrc}')`;
        pageBackground.style.backgroundSize = 'cover';
        pageBackground.style.backgroundPosition = 'center';
        pageBackground.style.position = 'absolute';
        pageBackground.style.top = '0';
        pageBackground.style.left = '0';
        
        pageElement.appendChild(pageBackground);
        
        // Interakt√≠v fed≈ër√©teg hozz√°ad√°sa, ha van defini√°lva
        const pageId = `page${index}`;
        if (pageOverlays[pageId] && pageOverlays[pageId].overlay) {
          const overlay = pageOverlays[pageId].overlay(pageElement);
          if (overlay) {
            pageElement.appendChild(overlay);
          }
        }
        
        pageElements.push(pageElement);
      });
      
      // Oldalak bet√∂lt√©se
      pageFlip.loadFromHTML(pageElements);
      
      // Audio
      const flipSound = document.getElementById("flipSound");
      const muteButton = document.getElementById("mute-button");
      let isMuted = false;
      
      // N√©m√≠t√°s gomb m≈±k√∂d√©se
      muteButton.addEventListener("click", () => {
        isMuted = !isMuted;
        muteButton.textContent = isMuted ? "üîá" : "üîä";
      });
      
      // Oldalsz√°m friss√≠t√©se indul√°skor
      const pageIndicator = document.getElementById("page-indicator");
      pageIndicator.textContent = `Oldal 1 / ${pageFlip.getPageCount()}`;
      
      // Lapoz√°s esem√©ny
      pageFlip.on('flip', (e) => {
        if (!isMuted) {
          flipSound.currentTime = 0;
          flipSound.play();
        }
        
        // Oldalsz√°m friss√≠t√©se
        pageIndicator.textContent = `Oldal ${e.data + 1} / ${pageFlip.getPageCount()}`;
      });
    });
  </script>
</body>
</html>