<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A Sötét Mágia Útvesztője</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0; padding: 0; width: 100%; height: 100%;
      overflow: hidden; background-color: #323232; font-family: 'Cinzel', serif;
    }
    #book-container {
      width: 100%; height: 100vh; overflow: hidden; position: relative;
    }
    #book-page {
      width: 100%; height: 100%; border: none; transition: opacity 0.3s, transform 0.3s;
    }
    .controls, #fullscreen-button, #page-indicator, .mute-toggle {
      position: fixed; z-index: 1000;
    }
    .controls {
      bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px;
    }
    .controls button, #fullscreen-button {
      padding: 10px; background: black; color: white; border-radius: 5px; cursor: pointer; border: none;
    }
    #fullscreen-button {
      bottom: 15%; left: 50%; transform: translateX(-50%);
    }
    .mute-toggle {
      bottom: 20px; left: 20px; width: 50px; height: 50px; background: #7f00ff; color: white;
      border-radius: 50%; cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center;
    }
    #page-indicator {
      bottom: 60px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: white; padding: 8px 16px; border-radius: 10px; pointer-events: none;
    }
  </style>
</head>
<body>

  <div id="book-container">
    <iframe id="book-page" src="pages/1.html"></iframe>
  </div>

  <div class="controls">
    <button id="prev-btn">◀ Előző oldal</button>
    <button id="next-btn">Következő oldal ▶</button>
    <button id="save-btn">🔖 Mentés</button>
    <button id="load-btn">📑 Betöltés</button>
    <button id="zoom-btn">🔍 Zoom</button>
  </div>

  <div id="page-indicator">Oldal 1 / 300</div>
  <button id="fullscreen-button">Teljes képernyő</button>
  <button id="mute-button" class="mute-toggle">🔊</button>
  
  <audio id="flipSound" src="sounds/pageturn-102978.mp3"></audio>

  <!-- Dobókocka widgetek -->
  <button id="dice-toggle" class="mute-toggle" style="right:20px;left:auto;bottom:20px;">🎲🎲🎲</button>
  <div id="dice-widget-container" style="display:none;position:fixed;bottom:80px;right:20px;background:rgba(0,0,0,0.8);padding:10px;border-radius:10px;"></div>

<script>
// MINDEN FUNKCIÓ EGY HELYEN, JÓL SZERVEZVE
document.addEventListener('DOMContentLoaded', () => {
  let currentPage = 1;
  const totalPages = 300;
  const iframe = document.getElementById('book-page');
  const flipSound = document.getElementById('flipSound');
  const pageIndicator = document.getElementById('page-indicator');

  const goToPage = num => {
    if (num < 1 || num > totalPages) return;
    iframe.style.opacity = 0;
    iframe.onload = () => { iframe.style.opacity = 1; updatePageIndicator(); };
    iframe.src = `pages/${num}.html`;
    currentPage = num;
    if (!flipSound.muted) flipSound.play();
  };

  const updatePageIndicator = () => {
    pageIndicator.textContent = `Oldal ${currentPage} / ${totalPages}`;
  };

  document.getElementById('next-btn').onclick = () => goToPage(currentPage + 1);
  document.getElementById('prev-btn').onclick = () => goToPage(currentPage - 1);

  document.getElementById('save-btn').onclick = () => {
    localStorage.setItem('bookmark', currentPage);
    alert(`Mentve: ${currentPage}. oldal`);
  };

  document.getElementById('load-btn').onclick = () => {
    let p = +localStorage.getItem('bookmark');
    if (p) goToPage(p); else alert('Nincs mentve könyvjelző.');
  };

  let zoomed = false;
  document.getElementById('zoom-btn').onclick = () => {
    zoomed = !zoomed;
    iframe.style.transform = zoomed ? 'scale(1.5)' : 'scale(1)';
  };

  document.getElementById('fullscreen-button').onclick = () => {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
  };

  document.getElementById('mute-button').onclick = () => {
    flipSound.muted = !flipSound.muted;
    document.getElementById('mute-button').textContent = flipSound.muted ? '🔇' : '🔊';
  };

  // DICE WIDGET (példa: 1 kocka)
  document.getElementById('dice-toggle').onclick = () => {
    let c = document.getElementById('dice-widget-container');
    c.style.display = c.style.display === 'none' ? 'block' : 'none';
    c.innerHTML = `
      <button onclick="this.nextElementSibling.textContent='Dobás: '+(1+Math.floor(Math.random()*6));" style="padding:8px;">Dobj 1 kockával</button>
      <div style="color:white;margin-top:5px;"></div>`;
  };

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js')
      .catch(e=>console.error('SW hiba:', e));
  }

  updatePageIndicator();
});
</script>
</body>
</html>
