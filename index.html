<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>A S√∂t√©t M√°gia √ötveszt≈ëje</title>
  <link rel="manifest" href="manifest.json">
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body, html {
      margin: 0; padding: 0; width: 100%; height: 100%;
      overflow: hidden; background-color: #323232; font-family: 'Cinzel', serif;
    }
    #book-container { width: 100%; height: 100vh; overflow: hidden; position: relative; }
    #book-page { width: 100%; height: 100%; border: none; transition: opacity 0.3s ease, transform 0.3s ease; }
    .controls, #fullscreen-button, #page-indicator, .mute-toggle { position: fixed; z-index: 1000; }
    .controls { bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 10px; }
    .controls button, #fullscreen-button { padding: 10px; background: black; color: white; border-radius: 5px; cursor: pointer; border: none; }
    #fullscreen-button { bottom: 20%; left: 50%; transform: translateX(-50%); }
    .mute-toggle { bottom: 20px; left: 20px; width: 50px; height: 50px; border-radius: 50%; background: #7f00ff; color: white; cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center; }
    #page-indicator { bottom: 40px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.7); color: white; padding: 5px 15px; border-radius: 5px; pointer-events: none; }
  </style>
</head>
<body>

<div id="book-container">
  <iframe id="book-page" src="pages/1.html"></iframe>
</div>

<div class="controls">
  <button onclick="prevPage()">‚óÄ El≈ëz≈ë oldal</button>
  <button onclick="nextPage()">K√∂vetkez≈ë oldal ‚ñ∂</button>
  <button onclick="saveBookmark()">üîñ Ment√©s</button>
  <button onclick="loadBookmark()">üìë Bet√∂lt√©s</button>
  <button onclick="toggleZoom()">üîç Zoom</button>
</div>

<div id="page-indicator">Oldal 1 / 300</div>
<div id="fullscreen-button">Teljes k√©perny≈ë</div>
<button id="mute-button" class="mute-toggle">üîä</button>

<audio id="flipSound" src="sounds/pageturn-102978.mp3" preload="auto"></audio>

<script>
document.addEventListener('DOMContentLoaded', () => {
  let currentPage = 1;
  const totalPages = 300;
  const iframe = document.getElementById('book-page');
  const pageIndicator = document.getElementById('page-indicator');
  const flipSound = document.getElementById('flipSound');
  const muteButton = document.getElementById('mute-button');
  const fullscreenBtn = document.getElementById('fullscreen-button');

  function updatePageIndicator() { pageIndicator.textContent = `Oldal ${currentPage} / ${totalPages}`; }

  function goToPage(pageNumber) {
    if (pageNumber < 1 || pageNumber > totalPages) return;
    iframe.style.opacity = 0;
    iframe.onload = () => { iframe.style.opacity = 1; updatePageIndicator(); };
    iframe.src = `pages/${pageNumber}.html`;
    currentPage = pageNumber;
    if (!flipSound.muted) flipSound.play();
  }

  function nextPage() { goToPage(currentPage + 1); }
  function prevPage() { goToPage(currentPage - 1); }

  muteButton.addEventListener('click', () => {
    flipSound.muted = !flipSound.muted;
    muteButton.textContent = flipSound.muted ? 'üîá' : 'üîä';
  });

  function saveBookmark() {
    localStorage.setItem('bookmark', currentPage);
    alert(`K√∂nyvjelz≈ë mentve: ${currentPage}. oldal`);
  }

  function loadBookmark() {
    const savedPage = parseInt(localStorage.getItem('bookmark'), 10);
    if (savedPage) goToPage(savedPage);
    else alert('Nincs mentett k√∂nyvjelz≈ë!');
  }

  let zoomedIn = false;
  function toggleZoom() {
    zoomedIn = !zoomedIn;
    iframe.style.transform = zoomedIn ? 'scale(1.5)' : 'scale(1)';
  }

  fullscreenBtn.onclick = () => {
    if (!document.fullscreenElement) document.documentElement.requestFullscreen();
    else document.exitFullscreen();
  };

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js').catch(err => console.error(err));
  }

  updatePageIndicator();

  // 3 kock√°s widget funkci√≥k
    function toggleDiceWidget() {
      const container = document.getElementById('dice-widget-container');
      if (container.style.display === 'none' || container.style.display === '') {
        // M√°sik widget elrejt√©se, ha l√°tszik
        document.getElementById('single-dice-widget-container').style.display = 'none';
        
        container.style.display = 'block';
        showDiceRoll();
      } else {
        container.style.display = 'none';
      }
    }

    function showDiceRoll() {
      const container = document.getElementById("dice-widget-container");
      if (!container) return;

      container.innerHTML = `
          <div style="text-align:center; margin-top:20px;">
              <h3 class="dice-title">
                  Harci Kockadob√°s
              </h3>
              <br>
              <button onclick="rollDice()" class="dice-button">
                  Dob√°s
              </button>
              <div class="dice-results" id="dice-images"></div>
              <div id="success-results"></div>
          </div>
      `;
    }

    function rollDice() {
      const diceImages = {
          1: 'images/d1.png',
          2: 'images/d2.png',
          3: 'images/d3.png',
          4: 'images/d4.png',
          5: 'images/d5.png',
          6: 'images/d6.png'
      };

      const diceContainer = document.getElementById('dice-images');
      const successResults = document.getElementById('success-results');
      diceContainer.innerHTML = '';

      let successes = 0;

      for (let i = 0; i < 3; i++) {
          const roll = Math.floor(Math.random() * 6) + 1;
          const img = document.createElement('img');
          img.src = diceImages[roll];
          img.alt = `Kocka: ${roll}`;
          img.style.width = '80px';
          img.style.height = '80px';
          diceContainer.appendChild(img);

          if (roll >= 4) {
              successes++;
          }
      }

      let successText = '';
      switch (successes) {
          case 0:
              successText = 'Nincs Siker';
              break;
          case 1:
              successText = 'Egy Siker';
              break;
          case 2:
              successText = 'K√©t Siker';
              break;
          case 3:
              successText = 'H√°rom Siker';
              break;
      }

      successResults.textContent = successText;
    }
    
    // 1 kock√°s widget funkci√≥k
    function toggleSingleDiceWidget() {
      const container = document.getElementById('single-dice-widget-container');
      if (container.style.display === 'none' || container.style.display === '') {
        // M√°sik widget elrejt√©se, ha l√°tszik
        document.getElementById('dice-widget-container').style.display = 'none';
        
        container.style.display = 'block';
        showSingleDiceRoll();
      } else {
        container.style.display = 'none';
      }
    }
    
    function showSingleDiceRoll() {
      const container = document.getElementById("single-dice-widget-container");
      if (!container) return;

      container.innerHTML = `
          <div style="text-align:center; margin-top:20px;">
              <h3 class="dice-title">
                  1D6 Kockadob√°s
              </h3>
              <br>
              <button onclick="rollSingleDice()" class="dice-button">
                  Dob√°s
              </button>
              <div class="dice-results" id="single-dice-image"></div>
          </div>
      `;
    }
    
    function rollSingleDice() {
      const diceImages = {
          1: 'images/d1.png',
          2: 'images/d2.png',
          3: 'images/d3.png',
          4: 'images/d4.png',
          5: 'images/d5.png',
          6: 'images/d6.png'
      };
      
      const diceContainer = document.getElementById('single-dice-image');
      diceContainer.innerHTML = ''; // El≈ëz≈ë k√©p t√∂rl√©se
      
      // 1D6 dob√°s
      const roll = Math.floor(Math.random() * 6) + 1;
      const img = document.createElement('img');
      img.src = diceImages[roll];
      img.alt = `Kocka: ${roll}`;
      img.style.width = '80px';
      img.style.height = '80px';
      diceContainer.appendChild(img);
    }
});
</script>
</body>
</html>
