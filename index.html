<!DOCTYPE html>
<html lang="hu">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>A S√∂t√©t M√°gia √ötveszt≈ëje</title>

  <!-- Meta tagek az original f√°jlb√≥l -->
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="monitor-signature" content="monitor:player:html5">
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge">
  <meta name="keywords" content="" />
  <meta name="description" content="" />
  <meta name="generator" content="fliphtml5.com" />
  
  <!-- K√∂z√∂ss√©gi megoszt√°shoz meta tagek -->
  <meta name="og:image" content="./files/icon-512.png">
  <meta property="og:image" content="./files/icon-512.png">
  <meta property="og:title" content="A S√∂t√©t M√°gia √ötveszt≈ëje" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="" />
  <meta property="og:description" content="" />
  <meta itemprop="name" content="A S√∂t√©t M√°gia √ötveszt≈ëje">
  <meta itemprop="description" content="">
  <meta itemprop="image" content="./files/icon-512.png">
  <meta name="twitter:site" content="@FlipHTML5">
  <meta name="twitter:title" content="A S√∂t√©t M√°gia √ötveszt≈ëje">
  <meta name="twitter:description" content="">
  <meta name="twitter:image" content="./files/icon-512.png">
  <meta name="twitter:card" content="summary_large_image">

  <!-- PWA - EREDETI FORM√ÅBAN -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/png" href="files/icon-512.png" />
  <meta name="theme-color" content="#000000" />
  <script>
    if ('serviceWorker' in navigator) {
      try {
        // Csak ha nem file:// protokollt haszn√°lunk
        if (window.location.protocol !== 'file:') {
          navigator.serviceWorker.register('service-worker.js')
            .then(reg => console.log("‚úî Service Worker regisztr√°lva:", reg.scope))
            .catch(err => console.log("‚ö†Ô∏è Service Worker hiba:", err));
        } else {
          console.log("Service Worker nem regisztr√°lhat√≥ file:// protokollal.");
        }
      } catch (e) {
        console.error("Service Worker hiba:", e);
      }
    }
  </script>

  <!-- Fontok -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&display=swap" rel="stylesheet">

  <!-- PageFlip -->
  <link rel="stylesheet" href="css/page-flip.min.css" />
  <script src="js/page-flip.browser.js"></script>

  <!-- Dob√≥kocka -->
  <script src="js/dice-widget.js"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #111;
      font-family: 'Cinzel', serif;
      overflow: hidden;
    }

    .book-container {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    #flipbook {
      width: 100%;
      height: 100%;
      max-width: 2000px;
      max-height: 95vh;
    }

    .page {
      width: 100%;
      height: 100%;
      background-position: center;
      background-repeat: no-repeat;
      background-size: contain;
      position: relative;
    }

    .fullscreen-toggle {
      position: absolute;
      top: 20px;
      left: 20px;
      background: #7f00ff;
      color: #fff;
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      z-index: 1000;
      font-family: 'Cinzel', serif;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .dice-button {
      position: absolute;
      bottom: 20px;
      right: 20px;
      padding: 10px 20px;
      background: #7f00ff;
      color: #fff;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      z-index: 1000;
      font-family: 'Cinzel', serif;
      box-shadow: 0 4px 8px rgba(0,0,0,0.3);
    }

    .dice-results {
      position: absolute;
      bottom: 70px;
      right: 20px;
      z-index: 1000;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      border-radius: 8px;
      color: white;
      font-size: 1rem;
    }

    .dice-results img {
      width: 40px;
      height: 40px;
    }

    /* Loader */
    #loader {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      flex-direction: column;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top-color: #7f00ff;
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* St√°tusz √ºzenet */
    #status-message {
      position: fixed;
      bottom: 10px;
      left: 0;
      width: 100%;
      background: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 8px;
      text-align: center;
      font-size: 14px;
      z-index: 9999;
    }

    /* Reszponz√≠v be√°ll√≠t√°sok */
    @media (max-width: 768px) {
      .fullscreen-toggle, .dice-button {
        padding: 8px 12px;
        font-size: 0.9rem;
      }
    }
  </style>
</head>
<body>
  <!-- Loader -->
  <div id="loader">
    <div class="spinner"></div>
    <div>Bet√∂lt√©s...</div>
  </div>

  <!-- St√°tusz √ºzenet -->
  <div id="status-message"></div>

  <div class="book-container">
    <button class="fullscreen-toggle" onclick="toggleFullscreen()">üî≥ Teljes k√©perny≈ë</button>
    <button class="dice-button" onclick="showDiceRoll()">üé≤ Dob√°s</button>
    <div class="dice-results" id="dice-widget-container"></div>

    <div id="flipbook">
      <!-- Az oldalak ide ker√ºlnek -->
    </div>
  </div>

  <script>
    // Glob√°lis v√°ltoz√≥k
    let pageFlip = null;
    
    // Seg√©df√ºggv√©nyek
    function showStatus(message, isError = false, duration = 5000) {
      const statusElement = document.getElementById('status-message');
      statusElement.textContent = message;
      statusElement.style.backgroundColor = isError ? 'rgba(220, 0, 0, 0.7)' : 'rgba(0, 0, 0, 0.7)';
      
      // Id≈ëz√≠tett elrejt√©s
      setTimeout(() => {
        statusElement.textContent = '';
      }, duration);
    }

    // Lok√°lis vagy szerver √ºzemm√≥d ellen≈ërz√©se
    function isLocalFileMode() {
      return window.location.protocol === 'file:';
    }

    // Teljes k√©perny≈ë funkci√≥
    function toggleFullscreen() {
      const elem = document.documentElement;
      
      if (!document.fullscreenElement) {
        elem.requestFullscreen().catch(err => {
          showStatus(`Teljes k√©perny≈ë hiba: ${err.message}`, true);
          console.error(`Teljes k√©perny≈ë hiba: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }

    // Dob√≥kocka megjelen√≠t√©se
    function showDiceRoll() {
      if (typeof window.showDiceRoll === 'function') {
        window.showDiceRoll();
      } else if (typeof rollDice === 'function') {
        rollDice();
      } else {
        showStatus("A dob√≥kocka funkci√≥ nem tal√°lhat√≥. Ellen≈ërizd, hogy a dice-widget.js megfelel≈ëen bet√∂lt≈ëd√∂tt-e.", true);
        console.error("A dob√≥kocka funkci√≥ nem tal√°lhat√≥.");
      }
    }
    
    // Oldalak l√©trehoz√°sa
    function createPages() {
      const flipbook = document.getElementById('flipbook');
      const pages = [
        { path: 'images/oldalak/borito.webp', title: 'Bor√≠t√≥' },
        { path: 'images/oldalak/elso-oldal.webp', title: 'Els≈ë oldal' },
        { path: 'images/oldalak/masodik-oldal.webp', title: 'M√°sodik oldal' },
        { path: 'images/oldalak/harmadik-oldal.webp', title: 'Harmadik oldal' },
        { path: 'images/oldalak/negyedik-oldal.webp', title: 'Negyedik oldal' },
        { path: 'images/oldalak/otodik-oldal.webp', title: '√ñt√∂dik oldal' },
        { path: 'images/oldalak/hatodik-oldal.webp', title: 'Hatodik oldal' },
        { path: 'images/oldalak/hetedik-oldal.webp', title: 'Hetedik oldal' },
        { path: 'images/oldalak/nyolcadik-oldal.webp', title: 'Nyolcadik oldal' },
        { path: 'images/oldalak/kilencedik-oldal.webp', title: 'Kilencedik oldal' }
      ];
      
      // Oldalak l√©trehoz√°sa
      flipbook.innerHTML = '';
      for (const page of pages) {
        const pageDiv = document.createElement('div');
        pageDiv.className = 'page';
        pageDiv.style.backgroundImage = `url('${page.path}')`;
        pageDiv.setAttribute('data-density', 'soft');
        flipbook.appendChild(pageDiv);
      }
    }
    
    // K√∂nyv inicializ√°l√°sa
    function initBook() {
      const pageFlipElement = document.getElementById('flipbook');
      
      try {
        // Oldalak l√©trehoz√°sa
        createPages();
        
        // PageFlip inicializ√°l√°sa
        pageFlip = new St.PageFlip(pageFlipElement, {
          width: 989,  // Eredeti m√©ret
          height: 1400, // Eredeti m√©ret
          size: "stretch",
          showCover: true,
          minWidth: 200,
          maxWidth: 2000,
          minHeight: 300,
          maxHeight: 2800,
          autoSize: true,
          drawShadow: true,
          flippingTime: 1000,
          usePortrait: true,
          startPage: 0,
          mobileScrollSupport: true
        });
        
        // Oldalak bet√∂lt√©se
        pageFlip.loadFromHTML(document.querySelectorAll('.page'));
        
        // Esem√©nykezel≈ëk
        pageFlip.on('flip', (e) => {
          console.log(`Oldal ford√≠t√°s: ${e.data}`);
        });
        
        // Ablakm√©ret v√°ltoz√°sn√°l friss√≠t√©s
        window.addEventListener('resize', function() {
          if (pageFlip) {
            // Csak a pageFlip.resize() f√ºggv√©nyt haszn√°ljuk
            pageFlip.resize();
          }
        });
        
        // T√∂lt≈ëk√©perny≈ë elrejt√©se
        document.getElementById('loader').style.display = 'none';
        
        // PWA figyelmeztet√©s lok√°lis m√≥dban
        if (isLocalFileMode()) {
          showStatus("Az oldal lok√°lis f√°jlk√©nt fut. A PWA √©s egy√©b funkci√≥k csak webszerveren m≈±k√∂dnek teljesen.", false, 10000);
        }
      } catch (error) {
        console.error("K√∂nyv inicializ√°l√°si hiba:", error);
        showStatus(`Hiba a k√∂nyv bet√∂lt√©sekor: ${error.message}`, true, 0);
        document.getElementById('loader').style.display = 'none';
      }
    }
    
    // Oldal bet√∂lt√©se ut√°n
    document.addEventListener('DOMContentLoaded', function() {
      // K√∂nyv inicializ√°l√°sa r√∂vid k√©sleltet√©ssel
      setTimeout(initBook, 500);
    });
  </script>
</body>
</html>